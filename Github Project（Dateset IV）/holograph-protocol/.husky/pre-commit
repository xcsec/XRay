#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# ---------------------------------------------------------------------------- #
#                                 Code updates                                 #
# ---------------------------------------------------------------------------- #

# -------------------------- Foundry code formatting ------------------------- #

# TODO: uncomment when the project as been migrate to foundry
# echo "ğŸ‘‰ Formatting code with Foundry..."
# forge fmt
# echo "âœ… Code formatted with Foundry.\n\n"

# ------------------------ Precompute Solidity Hashes ------------------------ #
echo "ğŸ‘‰ Precomputing Solidity hashes..."
npx ts-node scripts/precompute-solidity-hashes.ts
echo "âœ… Solidity hashes precomputed.\n\n"

# --------------------------- Add any changes made --------------------------- #
# temporary comments will be made until it is defined which files have to be add.
# git add .

# ---------------------------------------------------------------------------- #
#                                    Checks                                    #
# ---------------------------------------------------------------------------- #

# ------------------------------ Natspec smells ------------------------------ #
## check for env feature flag for natspec-smells. Default to true
if [ "$SKIP_NATSPEC_SMELLS" = "true" ]; then
  echo "ğŸ‘‰ Skipping natspec-smells check..."
  echo "â›”ï¸ WARNING: natspec-smells check has been skipped. THIS IS NOT THE RECOMMENDED PRACTICE."

  exit 0
else
  echo "ğŸ‘‰ Checking for missing natspecs..."
  natspecSmellsOutput=$(npx @defi-wonderland/natspec-smells 2>&1)

  # Compare the trimmed output to "No issues found"
  if [ "$natspecSmellsOutput" != "No issues found" ]; then
    echo "â›”ï¸ Missing documentation or errors have been found:"
    echo "$natspecSmellsOutput"
    exit 1
  else
    echo "âœ… No missing natspecs detected.\n"
  fi
fi
# ------------------------------- Gas snapshot ------------------------------- #

echo "ğŸ‘‰ Checking gas snapshots..."
npm run snapshot:check
echo "âœ… Gas snapshots are up to date.\n\n"

